#! /bin/sh
# obtain and export Rs environment variables
CXX=`${R_HOME}/bin/R CMD config CXX`
CXXFLAGS = `${R_HOME}/bin/R CMD config CXXFLAGS` `${R_HOME}/bin/R CMD config CXXPICFLAGS`
CPPFLAGS=`${R_HOME}/bin/R CMD config CPPFLAGS`
BLAS_LIBS=`${R_HOME}/bin/R CMD config BLAS_LIBS`
LAPACK_LIBS=`${R_HOME}/bin/R CMD config LAPACK_LIBS`
RCPP_DIR=`${R_HOME}/bin/Rscript -e "cat(system.file(package = 'Rcpp'))"`
export R_HOME
export CXX
export CXXFLAGS
export CPPFLAGS
export BLAS_LIBS
export LAPACK_LIBS
export R_INCLUDE_DIR
export RCPP_DIR

cd src

NCORES=`${R_HOME}/bin/Rscript -e "cat(parallel::detectCores(logical = FALSE))"`
sh install_vtk.sh ${NCORES}

# Compile trio library
cmake \
  -D VTK_DIR=vtk-install/lib/cmake/vtk-9.0 \
  -D CMAKE_BUILD_TYPE=Release \
  -S . \
  -B .
#(echo "#\!/bin/sh" && cat Makefile) > Makefile1 && mv Makefile1 Makefile
cmake --build . -j ${NCORES} --clean-first

#rm -f Makefile*
#rm -f CMakeCache.txt cmake_install.cmake
#rm -rf CMakeFiles
